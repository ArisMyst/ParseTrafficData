CREATE TABLE TRAFFIC_CONGESTION
(
LINK_TIMESTAMP_ID VARCHAR2(100) UNIQUE NOT NULL,
LINK_ID NUMBER(10) NOT NULL,
LINK_DIRECTION NUMBER(1) NOT NULL,
TIME_STAMP TIMESTAMP,
CONGESTION VARCHAR2(10));

CREATE TABLE THESSALONIKI
(
id	NUMBER(15)  UNIQUE NOT NULL,
osm_id	NUMBER(15) UNIQUE NOT NULL,
osmname	 VARCHAR2(100),
osm_source_id	NUMBER(15),
osm_target_id	NUMBER(15),
clazz	NUMBER(5),
flags	NUMBER(1),
source	NUMBER(15),
target	NUMBER(15),
length	FLOAT,
kmh	NUMBER(3),
cost FLOAT,
reverse_cost FLOAT,
x1	FLOAT,
y1	FLOAT,
x2	FLOAT,
y2	FLOAT,
category VARCHAR2(10)
);


SELECT UNIQUE(CATEGORY) FROM THESS2;

--DROP TABLE TRAFFIC_CONGESTION;

ALTER TABLE TRAFFIC_CONGESTION
ADD ( 
CONSTRAINT TRAFFIC_CONGESTION_PK PRIMARY KEY (TRAFFIC_CONGESTION_ID)
);

select sys_context('userenv','service_name') from dual;


INSERT INTO TRAFFIC_CONGESTION 
(LINK_TIMESTAMP_ID, LINK_ID, LINK_DIRECTION, TIME_STAMP, CONGESTION)
VALUES
('13769164_1_2019-10-02_04:00:00.000' ,13769164, 1, TO_TIMESTAMP('2019-10-02 04:00:00', 'YYYY-MM-DD HH24:MI:SS'),  'Low');

SELECT COUNT(*) FROM TRAFFIC_CONGESTION;

SELECT COUNT(*) FROM THESSALONIKI;

SELECT * FROM TRAFFIC_CONGESTION;

--DELETE FROM TRAFFIC_CONGESTION;


SELECT * FROM THESS2
WHERE OSM_NAME LIKE '%manoli andronikou%';

SELECT osm_id, osm_target_id FROM THESS2
WHERE OSM_NAME LIKE '%ioanni tsimiski%'
GROUP BY osm_id, osm_target_id;

SELECT osm_id FROM THESS2 T2
WHERE (T2.OSM_NAME LIKE '%ioanni tsimiski%' OR T2.OSM_NAME LIKE '%olgas%' OR (T2.OSM_NAME LIKE '%manoli andronikou%' 
AND T2.CATEGORY NOT IN ('KT600')))
GROUP BY osm_id
ORDER BY osm_id;

SELECT osm_id FROM THESS2 T2
WHERE (T2.OSM_NAME LIKE '%ioanni tsimiski%')
GROUP BY osm_id
ORDER BY osm_id;

SELECT
    t1.osm_id, t2.osm_id
FROM (
SELECT T1.osm_id, OSM_NAME, T1.x1, T1.Y1, T1.x2, T1.Y2, t1.CATEGORY FROM THESS2 T1
WHERE (T1.OSM_NAME LIKE '%ioanni tsimiski%' OR T1.OSM_NAME LIKE '%olgas%' OR (T1.OSM_NAME LIKE '%manoli andronikou%' 
AND T1.CATEGORY NOT IN ('KT600')))
) T1
INNER JOIN
(
SELECT T1.osm_id, OSM_NAME, T1.x1, T1.Y1, T1.x2, T1.Y2, t1.CATEGORY FROM THESS2 T1
WHERE (T1.OSM_NAME LIKE '%ioanni tsimiski%' OR T1.OSM_NAME LIKE '%olgas%' OR (T1.OSM_NAME LIKE '%manoli andronikou%' 
AND T1.CATEGORY NOT IN ('KT600')))
) T2 ON T1.X1 = T2.X2 AND T1.Y1 = T2.Y2
WHERE t1.osm_id != t2.osm_id;

SELECT * FROM THESS2 T1
WHERE t1.osm_id = 146160239;

commit;
-- , 'GR55134', 'GREECE', 2310444041, 'fsmith@ihu.gr', 'M', TO_DATE('20-12-1987','DD-MM-YYYY')); '2019-10-02 07:15:00.000',

SELECT t1.link_timestamp_id LINK_TIMESTAMP_ID,
t1.link_direction LINK_DIRECTION,
t1.time_stamp TIME_STAMP,
TO_CHAR(T1.time_stamp, 'HH24:MI') TIME,
TO_CHAR(T1.time_stamp, 'DAY') day,
t1.congestion CONGESTION,
t2.osm_id OSM_ID,
t2.osm_name OSM_NAME,
t2.clazz CLAZZ,
t2.flags FLAGS,
t2.kmh KMH,
t2.CATEGORY CATEGORY FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
WHERE (T2.OSM_NAME LIKE '%ioanni tsimiski%' OR T2.OSM_NAME LIKE '%olgas%' OR (T2.OSM_NAME LIKE '%manoli andronikou%' 
AND T2.CATEGORY NOT IN ('KT600')))
GROUP BY T1.link_timestamp_id, t1.link_direction, t1.time_stamp, TO_CHAR(T1.time_stamp, 'HH24:MI'), TO_CHAR(T1.time_stamp, 'DAY'), t1.congestion, t2.osm_id, 
t2.osm_name, t2.clazz, t2.flags, t2.kmh, t2.CATEGORY;


SELECT TO_CHAR(T1.time_stamp, 'DAY') day FROM traffic_congestion T1;

SELECT link_timestamp_id, TO_CHAR(T1.time_stamp, 'HH24:MI') TIME FROM traffic_congestion T1;


SELECT T2.OSM_ID FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
WHERE (T2.OSM_NAME LIKE '%ioanni tsimiski%' OR T2.OSM_NAME LIKE '%olgas%' OR (T2.OSM_NAME LIKE '%manoli andronikou%' 
AND T2.CATEGORY NOT IN ('KT600')))
GROUP BY T2.OSM_ID;

SELECT T2.OSM_ID FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
WHERE (T2.OSM_NAME LIKE '%ioanni tsimiski%' )
GROUP BY T2.OSM_ID;

SELECT t1.link_timestamp_id LINK_TIMESTAMP_ID,
TO_CHAR(T1.time_stamp, 'HH24:MI') TIME,
TO_CHAR(T1.time_stamp, 'DAY') day,
t1.congestion CONGESTION,
t2.osm_id OSM_ID,
t2.osm_name OSM_NAME,
t2.clazz CLAZZ,
t2.flags FLAGS,
t2.kmh KMH,
t2.CATEGORY CATEGORY FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
WHERE (T2.OSM_NAME LIKE '%ioanni tsimiski%' OR T2.OSM_NAME LIKE '%olgas%' OR (T2.OSM_NAME LIKE '%manoli andronikou%' 
AND T2.CATEGORY NOT IN ('KT600')))
GROUP BY T1.link_timestamp_id, TO_CHAR(T1.time_stamp, 'HH24:MI'), TO_CHAR(T1.time_stamp, 'DAY'), t1.congestion, t2.osm_id, 
t2.osm_name, t2.clazz, t2.flags, t2.kmh, t2.CATEGORY;

SELECT t1.link_timestamp_id LINK_TIMESTAMP_ID,
TO_CHAR(T1.time_stamp, 'HH24:MI') TIME,
TO_CHAR(T1.time_stamp, 'DAY') day,
t1.congestion CONGESTION,
t2.osm_id OSM_ID,
t2.osm_name OSM_NAME,
t2.clazz CLAZZ,
t2.flags FLAGS,
t2.kmh KMH,
t2.CATEGORY CATEGORY FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
WHERE (T2.OSM_NAME LIKE '%ioanni tsimiski%' )
GROUP BY T1.link_timestamp_id, TO_CHAR(T1.time_stamp, 'HH24:MI'), TO_CHAR(T1.time_stamp, 'DAY'), t1.congestion, t2.osm_id, 
t2.osm_name, t2.clazz, t2.flags, t2.kmh, t2.CATEGORY;

20420010
197107695
197107696
176665188
13769164
174019380

SELECT 
--t1.link_timestamp_id LINK_TIMESTAMP_ID,
TO_CHAR(T1.time_stamp, 'HH24:MI') TIME,
TO_CHAR(T1.time_stamp, 'DAY') day,
t1.congestion CONGESTION,
t2.osm_id OSM_ID,
t2.osm_name OSM_NAME,
--t2.clazz CLAZZ,
--t2.flags FLAGS,
T3.ROAD_LENGTH,
t2.kmh KMH,
t2.CATEGORY CATEGORY FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
INNER JOIN (
SELECT T2.OSM_ID, SUM(T2.LENGTH) ROAD_LENGTH
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,176665188,174019380))
GROUP BY T2.OSM_ID) T3 ON T3.OSM_ID = t1.link_id
WHERE (T2.OSM_ID IN (
--20420010,
--197107695,
197107696,
176665188,
--13769164,
174019380))
GROUP BY T1.link_timestamp_id, TO_CHAR(T1.time_stamp, 'HH24:MI'), TO_CHAR(T1.time_stamp, 'DAY'), t1.congestion, t2.osm_id, 
t2.osm_name, t2.clazz, t2.flags, t2.kmh, t2.CATEGORY;


--select for Decision tree
SELECT 
--t1.link_timestamp_id LINK_TIMESTAMP_ID,
TO_CHAR(T1.time_stamp, 'HH24:MI') TIME,
TO_CHAR(T1.time_stamp, 'DAY') day,
CASE 
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '09:00' AND '20:59') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('TUESDAY  ','FRIDAY   ','THURSDAY ')) THEN 'OPEN'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '09:00' AND '17:59') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('MONDAY   ','WEDNESDAY','SATURDAY ')) THEN 'OPEN'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '07:30' AND '08:59') AND (TO_CHAR(T1.time_stamp, 'DAY') NOT IN ('SUNDAY   ')) THEN 'OPENING'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '21:00' AND '22:00') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('TUESDAY  ','FRIDAY   ','THURSDAY ')) THEN 'CLOSING'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '18:00' AND '19:00') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('MONDAY   ','WEDNESDAY','SATURDAY ')) THEN 'CLOSING'
ELSE 'CLOSED'
END AS STORES,
--t1.congestion CONGESTION,
CASE 
WHEN T1.CONGESTION IN ('Medium') THEN '1'
WHEN T1.CONGESTION IN ('High') THEN '2'
ELSE '0'
END AS CONGESTION,
t2.osm_id OSM_ID,
--t2.osm_name OSM_NAME,
--t2.clazz CLAZZ,
--t2.flags FLAGS,
--TRUNC((T3.ROAD_LENGTH*1000), 0) ROAD_LENGTH_M,
CASE 
WHEN T3.ROAD_LENGTH*1000 > 200 THEN 'YES'
ELSE 'NO'
END AS LARGER_THAN_200M,
t2.kmh KMH,
T4.CATEGORY CATEGORY FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
INNER JOIN (
SELECT T2.OSM_ID, SUM(T2.LENGTH) ROAD_LENGTH
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,176665188,
13769164,
174019380))
GROUP BY T2.OSM_ID) T3 ON T3.OSM_ID = t1.link_id
INNER JOIN 
((SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
176665188))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
13769164))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
174019380))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)) T4 ON T4.OSM_ID = t1.link_id
WHERE (T2.OSM_ID IN (
--20420010,
--197107695,
197107696,
176665188,
13769164,
174019380))
GROUP BY T1.link_timestamp_id, TO_CHAR(T1.time_stamp, 'HH24:MI'), TO_CHAR(T1.time_stamp, 'DAY'), t1.congestion, t2.osm_id, 
t2.osm_name, T3.ROAD_LENGTH, t2.kmh, T4.CATEGORY;

--select for Decision tree
SELECT 
TO_CHAR(T1.time_stamp, 'HH24:MI') TIME,
TO_CHAR(T1.time_stamp, 'DAY') day,
CASE 
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '09:00' AND '20:59') AND (TO_CHAR(T1.time_stamp, 'DAY') 
IN ('TUESDAY  ','FRIDAY   ','THURSDAY ')) THEN 'OPEN'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '09:00' AND '17:59') AND (TO_CHAR(T1.time_stamp, 'DAY') 
IN ('MONDAY   ','WEDNESDAY','SATURDAY ')) THEN 'OPEN'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '07:30' AND '08:59') AND (TO_CHAR(T1.time_stamp, 'DAY') 
NOT IN ('SUNDAY   ')) THEN 'OPENING'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '21:00' AND '22:00') AND (TO_CHAR(T1.time_stamp, 'DAY') 
IN ('TUESDAY  ','FRIDAY   ','THURSDAY ')) THEN 'CLOSING'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '18:00' AND '19:00') AND (TO_CHAR(T1.time_stamp, 'DAY') 
IN ('MONDAY   ','WEDNESDAY','SATURDAY ')) THEN 'CLOSING'
ELSE 'CLOSED'
END AS STORES,
CASE 
WHEN T1.CONGESTION IN ('Medium') THEN '1'
WHEN T1.CONGESTION IN ('High') THEN '2'
ELSE '0'
END AS CONGESTION,
t2.osm_id OSM_ID,
CASE 
WHEN T3.ROAD_LENGTH*1000 > 200 THEN 'YES'
ELSE 'NO'
END AS LARGER_THAN_200M,
t2.kmh KMH,
T4.CATEGORY CATEGORY FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
INNER JOIN (
SELECT T2.OSM_ID, SUM(T2.LENGTH) ROAD_LENGTH
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,176665188,
13769164,
174019380))
GROUP BY T2.OSM_ID) T3 ON T3.OSM_ID = t1.link_id
INNER JOIN 
((SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
176665188))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
13769164))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
174019380))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)) T4 ON T4.OSM_ID = t1.link_id
WHERE (T2.OSM_ID IN (
197107696,
176665188,
13769164,
174019380))
GROUP BY T1.link_timestamp_id, TO_CHAR(T1.time_stamp, 'HH24:MI'), TO_CHAR(T1.time_stamp, 'DAY'), t1.congestion, t2.osm_id, 
t2.osm_name, T3.ROAD_LENGTH, t2.kmh, T4.CATEGORY;


--Logistic Regression (Binary Classification)
SELECT 
--t1.link_timestamp_id LINK_TIMESTAMP_ID,
TO_CHAR(T1.time_stamp, 'HH24:MI') TIME,
TO_CHAR(T1.time_stamp, 'DAY') day,
CASE 
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '09:00' AND '20:59') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('TUESDAY  ','FRIDAY   ','THURSDAY ')) THEN 'OPEN'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '09:00' AND '17:59') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('MONDAY   ','WEDNESDAY','SATURDAY ')) THEN 'OPEN'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '08:00' AND '08:59') AND (TO_CHAR(T1.time_stamp, 'DAY') NOT IN ('SUNDAY   ')) THEN 'OPENING'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '21:00' AND '21:59') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('TUESDAY  ','FRIDAY   ','THURSDAY ')) THEN 'CLOSING'
WHEN (TO_CHAR(T1.time_stamp, 'HH24:MI') BETWEEN '18:00' AND '18:59') AND (TO_CHAR(T1.time_stamp, 'DAY') IN ('MONDAY   ','WEDNESDAY','SATURDAY ')) THEN 'CLOSING'
ELSE 'CLOSED'
END AS STORES,
--t1.congestion CONGESTION,
CASE 
WHEN T1.CONGESTION IN ('Medium') THEN '1'
WHEN T1.CONGESTION IN ('High') THEN '2'
ELSE '0'
END AS CONGESTION,
t2.osm_id OSM_ID,
--t2.osm_name OSM_NAME,
--t2.clazz CLAZZ,
--t2.flags FLAGS,
TRUNC((T3.ROAD_LENGTH*1000), 0) ROAD_LENGTH_M,
--CASE 
--WHEN T3.ROAD_LENGTH*1000 > 200 THEN 'YES'
--ELSE 'NO'
--END AS LARGER_THAN_200M,
t2.kmh KMH,
T4.CATEGORY CATEGORY FROM traffic_congestion T1
INNER JOIN THESS2 T2 ON T2.OSM_ID = t1.link_id
INNER JOIN (
SELECT T2.OSM_ID, SUM(T2.LENGTH) ROAD_LENGTH
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,176665188,
13769164,
174019380))
GROUP BY T2.OSM_ID) T3 ON T3.OSM_ID = t1.link_id
INNER JOIN 
((SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
176665188))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
13769164))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
174019380))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)) T4 ON T4.OSM_ID = t1.link_id
WHERE (T2.OSM_ID IN (
--20420010,
--197107695,
197107696,
176665188,
13769164,
174019380))
GROUP BY T1.link_timestamp_id, TO_CHAR(T1.time_stamp, 'HH24:MI'), TO_CHAR(T1.time_stamp, 'DAY'), t1.congestion, t2.osm_id, 
t2.osm_name, T3.ROAD_LENGTH, t2.kmh, T4.CATEGORY;


SELECT T2.OSM_ID, SUM(T2.LENGTH) 
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380
))
--GROUP BY T2.ID;
GROUP BY T2.OSM_ID;

SELECT T2.ID, T2.OSM_ID, t2.CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380
));

SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC;

SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 3 ROWS ONLY;

SELECT OSM_ID, CATEGORY, CNT_CATEGORY FROM
((SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
176665188))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
13769164))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY)
UNION ALL
(SELECT T2.OSM_ID, T2.CATEGORY, COUNT(T2.CATEGORY) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
174019380))
GROUP BY T2.OSM_ID, T2.CATEGORY
ORDER BY COUNT(T2.CATEGORY) DESC
FETCH FIRST 1 ROWS ONLY));




SELECT T2.OSM_ID, T2.CATEGORY, max(COUNT(T2.CATEGORY)) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380))
GROUP BY T2.OSM_ID;


SELECT COUNT (T2.CATEGORY) OVER (PARTITION BY T2.CATEGORY) CNT_CATEGORY, T2.OSM_ID, T2.CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380));

SELECT min(T2.OSM_ID) keep(dense_rank first order by T2.CATEGORY) id, T2.CATEGORY, sum(COUNT(T2.CATEGORY)) CNT_CATEGORY
FROM THESS2 T2
WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380))
GROUP BY T2.CATEGORY;

WITH t2 AS
(

SELECT
    OSM_ID
,   CATEGORY
,   COUNT(T2.CATEGORY) CNT_CATEGORY
,   ROW_NUMBER() OVER (PARTITION BY OSM_ID ORDER BY COUNT(T2.CATEGORY) ASC) AS rn
FROM
    THESS2 t2
    WHERE (T2.OSM_ID IN (
197107696,
176665188,
174019380))
GROUP BY T2.OSM_ID, T2.CATEGORY
)
SELECT
    T2.OSM_ID
,   T2.CATEGORY
,   max(CNT_CATEGORY)
FROM
    t2
WHERE
    rn = 1;

select min(id) keep(dense_rank first order by kind) id
     , val
     , min(kind) kind
  from mytable
 group by val;


SELECT LINK_ID FROM traffic_congestion
GROUP BY LINK_ID;

SELECT COUNT(*) FROM 
(SELECT LINK_ID FROM traffic_congestion
GROUP BY LINK_ID);

SELECT AVG(ROAD_LENGTH) FROM (
SELECT T2.OSM_ID, SUM(T2.LENGTH) ROAD_LENGTH
FROM THESS2 T2
GROUP BY T2.OSM_ID);

SELECT T2.OSM_ID, SUM(T2.LENGTH) ROAD_LENGTH
FROM THESS2 T2
GROUP BY T2.OSM_ID
ORDER BY ROAD_LENGTH DESC;